<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Your Profile | Raversus Syndicates</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background: #f3f4f6;
      color: #111;
    }

    .container {
      max-width: 900px;
      margin: 40px auto;
      background: #fff;
      padding: 30px;
      border-radius: 14px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.12);
    }

    h1 { font-size: 32px; font-weight: 800; }
    h2 { font-size: 24px; margin-top: 30px; font-weight: 700; }

    label {
      display: block;
      margin-top: 18px;
      font-weight: 600;
    }

    input, select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 6px;
      font-size: 16px;
    }

    .btn {
      margin-top: 30px;
      padding: 14px 20px;
      background: #ff4459;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      font-size: 18px;
    }

    .logout-btn {
      margin-top: 20px;
      width: 100%;
      background: #111;
    }

  </style>
</head>
<body>

  <div class="container">
    <h1>Your Profile</h1>
    <p>Please complete your profile so we can personalise your experience and enable payouts.</p>

    <form id="profileForm">

      <h2>Personal Information</h2>

      <label>First Name</label>
      <input id="first_name">

      <label>Last Name</label>
      <input id="last_name">

      <label>Date of Birth</label>
      <input id="dob" type="date">

      <label>Mobile Number</label>
      <input id="mobile" placeholder="e.g., +27 82 123 4567">

      <label>Home Address</label>
      <input id="address">

      <h2>Banking Details (for payouts)</h2>

      <label>Bank Name</label>
      <input id="bank_name">

      <label>Account Holder Name</label>
      <input id="account_name">

      <label>Account Number</label>
      <input id="account_number">

      <label>Account Type</label>
      <select id="account_type">
        <option value="Cheque">Cheque</option>
        <option value="Savings">Savings</option>
        <option value="Transmission">Transmission</option>
      </select>

      <label>Branch Code</label>
      <input id="branch_code">

      <label>Additional Notes</label>
      <input id="payout_notes">

      <button class="btn" onclick="saveProfile()">Save Profile</button>
    </form>

    <button class="btn logout-btn" onclick="logout()">Log Out</button>

  </div>


<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabaseClient = supabase.createClient(
    "https://whnnyuozicuphrpgomno.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indobm55dW96aWN1cGhycGdvbW5vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1Mjk3MDAsImV4cCI6MjA3OTEwNTcwMH0.XTS5-ELx7sUmZmkyoXG1B1zOqVMJQsO5Kvk-brBW8EQ",
    { auth: { persistSession: true, autoRefreshToken: true } }
  );

  let sessionUser = null;

  async function loadProfile() {
    const { data: { session } } = await supabaseClient.auth.getSession();
    if (!session) {
      window.location.href = "index.html";
      return;
    }

    sessionUser = session.user;

    const { data } = await supabaseClient
      .from("profiles")
      .select("*")
      .eq("id", sessionUser.id)
      .maybeSingle();

    if (data) {
      document.getElementById("first_name").value = data.first_name || "";
      document.getElementById("last_name").value = data.last_name || "";
      document.getElementById("dob").value = data.dob || "";
      document.getElementById("mobile").value = data.mobile || "";
      document.getElementById("address").value = data.address || "";

      document.getElementById("bank_name").value = data.bank_name || "";
      document.getElementById("account_name").value = data.account_name || "";
      document.getElementById("account_number").value = data.account_number || "";
      document.getElementById("account_type").value = data.account_type || "";
      document.getElementById("branch_code").value = data.branch_code || "";
      document.getElementById("payout_notes").value = data.payout_notes || "";
    }
  }

  async function saveProfile() {
    event.preventDefault();

    const payload = {
      id: sessionUser.id,
      first_name: document.getElementById("first_name").value,
      last_name: document.getElementById("last_name").value,
      dob: document.getElementById("dob").value,
      mobile: document.getElementById("mobile").value,
      address: document.getElementById("address").value,
      bank_name: document.getElementById("bank_name").value,
      account_name: document.getElementById("account_name").value,
      account_number: document.getElementById("account_number").value,
      account_type: document.getElementById("account_type").value,
      branch_code: document.getElementById("branch_code").value,
      payout_notes: document.getElementById("payout_notes").value
    };

    await supabaseClient.from("profiles").upsert(payload);
    alert("Profile saved!");
    window.location.href = "members.html";
  }

  async function logout() {
    await supabaseClient.auth.signOut();
    window.location.href = "index.html";
  }

  loadProfile();
</script>

</body>
</html>
